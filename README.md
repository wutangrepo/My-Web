# My-Web — Hugo Site

My-Web is a Hugo-powered static website. This repository contains the site content, configuration, and theme as a Git submodule. Builds and deployments are automated with GitHub Actions and published to a remote server via `rsync` over SSH.

- Live site: https://wuweb.westeurope.cloudapp.azure.com/
- Static site generator: [Hugo](https://gohugo.io/) (extended)
- Configuration: `hugo.yaml`
- Theme: managed as a Git submodule in `themes/`

## Quick start

### Prerequisites
- Hugo extended installed locally:
  - macOS: `brew install hugo`
  - Linux: download from https://github.com/gohugoio/hugo/releases
  - Verify: `hugo version`
- Git with submodule support

### Clone the repo (including theme)
```bash
git clone --recurse-submodules https://github.com/wutangrepo/My-Web.git
cd My-Web
# If you forgot --recurse-submodules, run:
git submodule update --init --recursive
```

### Run locally
```bash
# Start a local dev server with drafts
hugo server -D

# Build production output to ./public
hugo --minify
```

## Configuration

- Main Hugo config: [`hugo.yaml`](./hugo.yaml)
  - Common values to review:
    - `baseURL`: set this to your site URL (e.g., `https://wuweb.westeurope.cloudapp.azure.com/`)
    - `languageCode`, `title`, `params` for theme-specific settings
- Archetypes: [`archetypes/`](./archetypes) for content blueprints
- Content: typically under `content/` (create if not present)
- Output: Hugo writes the built site to `public/`

### Create new content
```bash
# Example: create a new post
hugo new posts/my-first-post.md
```

## Theme

This project uses a theme via Git submodule stored in `themes/`. Keep it updated with:
```bash
git submodule update --remote --merge
```

## CI/CD: Build and deploy with GitHub Actions

This repository includes a workflow at [`.github/workflows/main.yml`](.github/workflows/main.yml) that:

1. Triggers on pushes to the `main` branch
2. Checks out the repo (including submodules)
3. Sets up Hugo (extended)
4. Builds the site
5. Sets up SSH and trusts the deploy host
6. Deploys the `public/` directory to your server using `rsync`

### Required repository secrets

Set these in your repository settings under Settings → Secrets and variables → Actions → New repository secret:

- `DEPLOY_KEY`: Private SSH key with access to the target server (no passphrase or use an agent).
- `DEPLOY_USER`: SSH username on the target server (e.g., `azureuser`).
- `DEPLOY_HOST`: Hostname or IP of the target server (e.g., `wuweb.westeurope.cloudapp.azure.com`).
- `DEPLOY_PORT`: SSH port (e.g., `22`).
- `DEPLOY_PATH`: Absolute path on the server where files are published (e.g., `/var/www/html/my-blog`).

The workflow uses these secrets to authenticate and run:
```bash
rsync -az --delete -e "ssh -p $DEPLOY_PORT" public/ "$DEPLOY_USER@$DEPLOY_HOST:$DEPLOY_PATH/"
```

## Server expectations

- The web server (e.g., Nginx) should serve files from `DEPLOY_PATH`
- The deploy user must have write permissions to `DEPLOY_PATH`
- SSH access must be allowed for the deploy user using the corresponding public key

If you provision your server with Ansible, ensure:
- `DEPLOY_PATH` exists and is owned by the deploy user (group often `www-data`)
- Nginx’s server block `root` points to `DEPLOY_PATH`
- TLS (Let’s Encrypt) is configured for HTTPS

## Repository layout

- `.github/workflows/main.yml` — GitHub Actions workflow for build and deploy
- `hugo.yaml` — Hugo configuration
- `themes/` — Theme as a Git submodule
- `archetypes/` — Content templates
- `content/` — Your site content (add as needed)
- `public/` — Build output (generated by Hugo; typically not committed)

## Troubleshooting

- Submodules not found
  ```bash
  git submodule update --init --recursive
  ```
- Wrong base URL in production
  - Update `baseURL` in `hugo.yaml` and rebuild
- Permission denied during deploy
  - Verify the deploy user’s write access to `DEPLOY_PATH`
  - Ensure the server’s `~/.ssh/authorized_keys` contains the public key that matches `DEPLOY_KEY`
- Host key verification failed
  - The workflow adds the host key via `ssh-keyscan`. Confirm `DEPLOY_HOST` and `DEPLOY_PORT` are correct.

## License

Specify your preferred license here (e.g., MIT, Apache-2.0), and include a `LICENSE` file if applicable.
